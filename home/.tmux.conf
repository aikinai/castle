# ~/.tmux.conf

# ┌───────────────────────────────────────────────────────────────────┐
# │ CORE BEHAVIOR                                                     │
# └───────────────────────────────────────────────────────────────────┘
# Change prefix from C-b to C-a.
set -g prefix C-a
bind C-a send-prefix

# Increase history limit.
set -g history-limit 10000

# Set vi-style keys for copy mode.
# Note: `status-keys vi` is handled by tmux-sensible.
setw -g mode-keys vi

# ┌───────────────────────────────────────────────────────────────────┐
# │ KEYBINDINGS                                                       │
# └───────────────────────────────────────────────────────────────────┘
# Pane navigation with vi keys.
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Split panes using | and -.
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Pressing C-a twice cycles to the last active window.
bind C-a last-window

# ┌───────────────────────────────────────────────────────────────────┐
# │ MOUSE & COPY MODE                                                 │
# └───────────────────────────────────────────────────────────────────┘
# Enable mouse support.
setw -g mouse on

# Make mouse scrolling feel more natural: enter copy mode on scroll,
# and pass through to application when at the top/bottom of scrollback.
bind -n WheelUpPane   select-pane -t= \; copy-mode -e \; send-keys -M
bind -n WheelDownPane select-pane -t= \; send-keys -M

# Configure vi-style visual selection in copy mode.
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel

# Smart clipboard integration:
# - When remote (SSH/Mosh), use OSC 52 sequence for system clipboard.
# - When local, pipe directly to `pbcopy`.
set -g set-clipboard on
if-shell '[ -n "$SSH_TTY$SSH_CONNECTION$MOSH_SESSION" ]' \
    'bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "tmux set-buffer -w -"' \
    'bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"'

# ┌───────────────────────────────────────────────────────────────────┐
# │ TERMINAL & COLORS                                                 │
# └───────────────────────────────────────────────────────────────────┘
# Set the default terminal to advertise 256-color support.
set -g default-terminal "tmux-256color"

# Enable capabilities for terminals that support them.
# 'RGB' is for truecolor, 'clipboard' for modern clipboard integration.
set -as terminal-features '*,xterm-256color:RGB'
set -as terminal-features '*,xterm-ghostty:RGB'

# Teach tmux about Ghostty's capabilities, including clipboard (Ms) and
# cursor shaping (Ss for set, Se for reset to default).
# This is crucial for zsh-vi-mode cursor changes to work correctly.
set -ga terminal-overrides ',xterm-ghostty:Ms=\033]52;c;%p1%s\007:Ss=\033[%p1%d q:Se=\033[2 q'

# ┌───────────────────────────────────────────────────────────────────┐
# │ UI & STATUS BAR                                                   │
# └───────────────────────────────────────────────────────────────────┘
# Set status bar position and refresh interval.
set -g status-position bottom
set -g status-interval 2

# Set status bar lengths to prevent truncation.
set -g status-left-length 60
set -g status-right-length 120

# Format the current window tab to show index and name (e.g., "1* zsh").
setw -g window-status-current-format '#[bold]#I* #W'

# ┌───────────────────────────────────────────────────────────────────┐
# │ TPM (TMUX PLUGIN MANAGER)                                         │
# └───────────────────────────────────────────────────────────────────┘
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible' # Provides sane defaults
set -g @plugin 'jimeh/tmux-themepack'       # UI themes

# Configure the theme from tmux-themepack.
set -g @themepack 'powerline/default/green'

# Initialize TPM. This MUST be the last line in the config.
run -b "$HOME/.tmux/plugins/tpm/tpm"
